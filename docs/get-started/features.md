# SDK ä»‹ç´¹

- [SDK ä»‹ç´¹](#sdk-%E4%BB%8B%E7%B4%B9)
  - [æ ¸å¿ƒæ¦‚å¿µ](#%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5)
  - [è‡ªå‹•ç²å–æ©Ÿå™¨äººQQè™Ÿ](#%E8%87%AA%E5%8B%95%E7%8D%B2%E5%8F%96%E6%A9%9F%E5%99%A8%E4%BA%BAqq%E8%99%9F)
  - [äº‹ä»¶å‚³æ’­](#%E4%BA%8B%E4%BB%B6%E5%82%B3%E6%92%AD)
  - [å¿«é€ŸéŸ¿æ‡‰](#%E5%BF%AB%E9%80%9F%E9%9F%BF%E6%87%89)
    - [ç¯„ä¾‹: å”è­°å¼éŸ¿æ‡‰](#%E7%AF%84%E4%BE%8B-%E5%8D%94%E8%AD%B0%E5%BC%8F%E9%9F%BF%E6%87%89)
  - [ç™¼é€çµæœè¿½è¹¤](#%E7%99%BC%E9%80%81%E7%B5%90%E6%9E%9C%E8%BF%BD%E8%B9%A4)
  - [æ¶ˆæ¯æ ¼å¼](#%E6%B6%88%E6%81%AF%E6%A0%BC%E5%BC%8F)
    - [ä¸Šå ±æ¶ˆæ¯](#%E4%B8%8A%E5%A0%B1%E6%B6%88%E6%81%AF)
    - [ç™¼é€æ¶ˆæ¯](#%E7%99%BC%E9%80%81%E6%B6%88%E6%81%AF)
    - [å»¶ä¼¸é–±è®€](#%E5%BB%B6%E4%BC%B8%E9%96%B1%E8%AE%80)

## æ ¸å¿ƒæ¦‚å¿µ

CQWebSocket SDK æ˜¯åŸºæ–¼ CQHTTP API æ’ä»¶ä¹‹ WebSocket é€šè¨Šï¼Œåº•å±¤å°è£äº†å…©å€‹ socketï¼Œåˆ†åˆ¥ç‚º `/api` å’Œ `/event` (è©³ç´°åŠŸèƒ½æè¿°å¯è¦‹ [coolq-http-api/websocket](https://cqhttp.cc/docs/#/WebSocketAPI?id=api-%E6%8E%A5%E5%8F%A3))ã€‚

CQWebSocket SDK ä½¿é–‹ç™¼è€…èƒ½å¤ æ›´å°ˆå¿ƒæ–¼æ©Ÿå™¨äººæ‡‰ç”¨çš„é–‹ç™¼ï¼ŒSDK ç‚ºé–‹ç™¼è€…æä¾›åº•å±¤é€£ç·šçš„ç¶­è­·ã€æ–·ç·šé‡é€£ç­‰åŠŸèƒ½ï¼Œä¸¦ç¬¬ä¸€æ‰‹å…ˆè™•ç†äº†ä¸Šå ±äº‹ä»¶ï¼Œä¾ç…§ä¸åŒäº‹ä»¶é¡å‹ï¼Œå°‡äº‹ä»¶æ–‡æœ¬åˆ†ç™¼è‡³å„äº‹ä»¶ç›£è½å™¨è™•ç†ã€‚

## è‡ªå‹•ç²å–æ©Ÿå™¨äººQQè™Ÿ
è‹¥æ©Ÿå™¨äººé…ç½® `enableAPI` ç‚º true, ä¸”æ²’æœ‰é€šé `qq` é …é…ç½®æ©Ÿå™¨äººIDçš„è©±, é€£ç·šå»ºç«‹æˆåŠŸå¾Œæœƒä¸»å‹•ç™¼é€ API è«‹æ±‚å‘ CQHTTP API å–å¾—é…·Qæ­£ç™»éŒ„çš„QQè™Ÿä½œç‚ºæ©Ÿå™¨äººQQè™Ÿã€‚

æ­¤æ“ä½œç‚ºç•°æ­¥æ“ä½œ, åœ¨APIéŸ¿æ‡‰ä¹‹å‰, `@.me` äº‹ä»¶å‡ä¸æœƒç™¼å¸ƒã€‚

**é™¤é**çœŸçš„æœ‰äººQQè™Ÿæ˜¯ `-1`, å“ªå°¼å£é›· Î£(*ï¾ŸĞ´ï¾Ÿï¾‰)ï¾‰

## äº‹ä»¶å‚³æ’­
äº‹ä»¶å…·æœ‰å‘ä¸Šå‚³æ’­çš„æ©Ÿåˆ¶ï¼Œä¸€å€‹äº‹ä»¶ä¸Šå ±ä¹‹å¾Œï¼Œè©²äº‹ä»¶ä¹‹æ‰€æœ‰**è¦ªäº‹ä»¶**ä¹Ÿæœƒä¾åºä¸Šå ±ã€‚
äº‹ä»¶åç¨±ä»¥ `.` ç›¸äº’é€£æ¥ï¼Œå½¢æˆå…·æœ‰ç¹¼æ‰¿é—œä¿‚çš„çµæ§‹ï¼Œå¦‚ `message` (ä»»æ„æ¶ˆæ¯äº‹ä»¶) ç‚º `message.group` (ç¾¤æ¶ˆæ¯) çš„è¦ªäº‹ä»¶ã€‚
é—œæ–¼äº‹ä»¶è¦ªå­é—œä¿‚çš„æ§‹æˆï¼Œå¯åƒè€ƒ[äº‹ä»¶æ¨¹](../api/events.md#%E4%BA%8B%E4%BB%B6%E6%A8%B9)ã€‚

èˆ‰å€‹ä¾‹å­ï¼Œç¾¤æ¶ˆæ¯æœ‰äºº@æŸæ©Ÿå™¨äººï¼Œè©²æ©Ÿå™¨äººå‰‡æœƒé¦–å…ˆä¸Šå ± `message.group.@.me` äº‹ä»¶ï¼Œè©²äº‹ä»¶ä¹‹è¦ªäº‹ä»¶ç”±ä¸‹è€Œä¸Šä¾åºç‚º `message.group.@`, `message.group` ã€ `message` ï¼Œå‰‡é€™å¹¾å€‹äº‹ä»¶ä¹Ÿæœƒä¾ç…§é€™å€‹é †åºä¸Šå ±ï¼Œé€™æ¨£ç¨±ç‚ºä¸€æ¬¡**äº‹ä»¶å‚³æ’­**ã€‚

## å¿«é€ŸéŸ¿æ‡‰

> åƒ… `message` åŠå…¶å­äº‹ä»¶æ”¯æ´æ­¤æ©Ÿåˆ¶ã€‚

`message` åŠå…¶å­äº‹ä»¶ç›£è½å™¨çš„ç¬¬ä¸€å€‹åƒæ•¸ï¼š `CQEvent` é¡åˆ¥å¯¦ä¾‹ï¼Œåœ¨é€™å€‹æ©Ÿåˆ¶ä¸­æ‰®æ¼”é‡è¦çš„è§’è‰²ã€‚
é€é `CQEvent` å¯¦ä¾‹ï¼Œæ‰€æœ‰ç›£è½å™¨çš†å¯åœ¨è‡ªå·±çš„é‹è¡ŒæœŸé–“èª¿ç”¨ `CQEvent #stopPropagation()` æ–¹æ³•è²æ˜è‡ªå·±çš„è™•ç†æ¬Šï¼Œä»¥æˆªç²äº‹ä»¶ä¸¦é˜»æ–·å¾ŒçºŒç›£è½å™¨çš„èª¿ç”¨ï¼Œä¸¦ç«‹å³ä»¥è©²äº‹ä»¶è¿”å›ä¹‹æ–‡å­—è¨Šæ¯(æˆ–é€éèª¿ç”¨ `CQEvent #setMessage(msg)` è¨­å®šä¹‹æ–‡å­—è¨Šæ¯ï¼Œä¹Ÿå¯ä»¥é€é `Promise` å°è±¡ resolve ä¹‹æ–‡å­—è¨Šæ¯)ä½œç‚ºéŸ¿æ‡‰ï¼Œé€å›è‡³ CQHTTP API æ’ä»¶ç«¯ã€‚

ç”±æ–¼åœ¨ä¸€æ¬¡äº‹ä»¶å‚³æ’­ä¸­çš„æ‰€æœ‰ç›£è½å™¨éƒ½æœƒæ”¶åˆ°åŒä¸€å€‹ `CQEvent` å¯¦ä¾‹ï¼Œå› æ­¤å°æ–¼éŸ¿æ‡‰çš„æ±ºå®šæ–¹å¼ï¼Œé™¤äº† `CQEvent #stopPropagation()` æ‰€æä¾›çš„äº‹ä»¶æˆªç²æ©Ÿåˆ¶ä¹‹å¤–ï¼Œä¹Ÿå¯ä»¥æ¡å–å”è­°å¼çš„æ–¹å¼ï¼Œå°±æ˜¯é€éæ¯å€‹ç›£è½å™¨èª¿ç”¨ `CQEvent #getMessage()` `CQEvent #setMessage(msg)` å”è­°å‡ºä¸€å€‹æœ€çµ‚çš„éŸ¿æ‡‰è¨Šæ¯ã€‚

### ç¯„ä¾‹: å”è­°å¼éŸ¿æ‡‰
å‡è¨­æ©Ÿå™¨äººå…·æœ‰ä»¥ä¸‹ä»£ç¢¼ã€‚

```js
// app.js

const { CQWebSocket } = require('cq-websocket')
const bot = CQWebSocket()

const plugins = [
  require('./pluginA'),
  require('./pluginB')
]

plugins.forEach(plugin => {
  bot.on('message.private', plugin)
})

```

```js
// pluginA.js
module.exports = function (e) {
  if (e.hasMessage()) {
    e.appendMessage(' world!')
  } else {
    e.setMessage('Hello')
  }
}
```

```js
// pluginB.js
module.exports = function (e) {
  if (e.hasMessage()) {
    e.appendMessage(' CQWebSocket!')
  } else {
    e.setMessage('Hi')
  }
}
```

æ­¤æ™‚è‹¥æ©Ÿå™¨äººæ”¶åˆ°äº†ä¸€å‰‡ç§äººæ¶ˆæ¯ï¼Œå‰‡æœƒéŸ¿æ‡‰ `"Hello CQWebSocket!"`ã€‚

æˆ‘å€‘ä¹Ÿå¯ä»¥è—‰æ­¤æ©Ÿåˆ¶ï¼ŒåŠ å…¥æ¶ˆæ¯éæ¿¾çš„åŠŸèƒ½ã€‚
é¦–å…ˆåœ¨æ©Ÿå™¨äººçš„ `app.js` åŠ å…¥ä»¥ä¸‹ä»£ç¢¼ã€‚
```js
// app.js
const pluginGuard = require('./pluginGuard')

// æ–¼æœ€ä¸Šå±¤è¦ªäº‹ä»¶æª¢æŸ¥æ‰€æœ‰éŸ¿æ‡‰è¨Šæ¯
bot.on('message', pluginGuard)
```

```js
// pluginGuard.js
module.exports = function (e) {
  if (e.hasMessage()) {
    e.stopPropagation()

    // é—œéµå­—éæ¿¾
    e.setMessage(
      e.getMessage().replace(/é—œéµå­—/g, '')
    )
  }
}
```

## ç™¼é€çµæœè¿½è¹¤
ä¸è«–æ˜¯å¿«é€ŸéŸ¿æ‡‰æˆ–æ˜¯ API èª¿ç”¨å‡æœ‰æ­¤æ©Ÿåˆ¶ã€‚

è¿½è¹¤å¿«é€ŸéŸ¿æ‡‰ä¹‹çµæœï¼Œå¯é€šé CQEvent `#onResponse()` è¨­ç½®çµæœç›£è½å™¨, ä¸¦é€é CQEvent `#onError()` è™•ç†éŸ¿æ‡‰çš„éŒ¯èª¤ã€‚
è‹¥æ²’æœ‰ CQEvent `#onError()` é€²è¡ŒéŒ¯èª¤è™•ç†, ç™¼ç”ŸéŸ¿æ‡‰éŒ¯èª¤æ™‚æœƒè§¸ç™¼ [`error` äº‹ä»¶](#åŸºæœ¬äº‹ä»¶)ã€‚

è¿½è¹¤ API èª¿ç”¨ä¹‹çµæœï¼Œå¯ä»¥åˆ©ç”¨ [`bot(method[, params[, options]])`](../api/CQWebSocket.md#api-call) è¿”å›çš„ Promise å°è±¡é€²è¡Œè¿½è¹¤ã€‚

## æ¶ˆæ¯æ ¼å¼
### ä¸Šå ±æ¶ˆæ¯
`message` äº‹ä»¶ä¸­ï¼Œç›£è½å™¨ç¬¬ä¸‰å€‹åƒæ•¸ç‚ºä¸€å€‹ `CQTag` çš„æ•¸çµ„ï¼Œé—œæ–¼è©²æ•¸çµ„å…§å¯èƒ½å‡ºç¾çš„å…ƒç´ ï¼Œå¯ä»¥åƒè€ƒ[CQ ç¢¼ç›¸é—œé¡åˆ¥](../api/messages.md)ã€‚

â€»é™¤äº†å·²å®šç¾©çš„ CQTag ä¹‹å¤–ï¼Œå…¶é¤˜çš„å…§å®¹éƒ½æœƒç•¶ä½œ CQText çš„å­—ç¬¦ä¸²è™•ç†ã€‚

èˆ‰ä¾‹ï¼Œä¸Šå ±æ¶ˆæ¯ä¸­å«æœ‰ä¸€å€‹ä¸åœ¨å®šç¾©ä¸­çš„ CQ ç¢¼ `"[CQ:unknown,key=value]"`ï¼Œå‰‡æ­¤ CQ ç¢¼æœƒè¢« Parser åˆ¤å®šç‚ºä¸€å€‹ CQText å¯¦ä¾‹ï¼Œç­‰åŒ `new CQText('[CQ:unknown,key=value]')`ã€‚

### ç™¼é€æ¶ˆæ¯
ä¸è«–æ˜¯å¿«é€ŸéŸ¿æ‡‰æˆ–æ˜¯ API èª¿ç”¨ç™¼é€æ¶ˆæ¯ï¼Œå‡å¯ä½¿ç”¨ä»¥ä¸‹æ¶ˆæ¯æ ¼å¼ã€‚
1. [å­—ç¬¦ä¸²æ ¼å¼](https://cqhttp.cc/docs/#/Message?id=%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%A0%BC%E5%BC%8F)
2. [æ•¸çµ„æ ¼å¼](https://cqhttp.cc/docs/#/Message?id=%E6%95%B0%E7%BB%84%E6%A0%BC%E5%BC%8F)

å…¶ä¸­ï¼Œæ•¸çµ„æ ¼å¼åœ¨æœ¬ SDK çš„æ“´å¢ä¸‹ï¼Œæ”¯æŒäº†å°‡æœ¬ SDK çš„ [CQ ç¢¼ç›¸é—œé¡åˆ¥](../api/messages.md)ç›´æ¥ä½œç‚ºæ•¸çµ„çš„å…§å®¹ã€‚

é¦–å…ˆå¯ä»¥å…ˆäº†è§£ä¸€ä¸‹ CQHTTP API æ‰€æä¾›çš„[æ¶ˆæ¯æ®µå°è±¡](../api/CQHTTPMessage.md)ï¼Œæ­¤æ¶ˆæ¯æ®µåœ¨é€™é‚Šæˆ‘å€‘å§‘ä¸”ç¨±ä¹‹ç‚º `CQHTTPMessage`ã€‚

å¿«é€ŸéŸ¿æ‡‰æˆ–æ˜¯ API èª¿ç”¨ç™¼é€æ¶ˆæ¯æ™‚ï¼Œå¯ä»¥ä½¿ç”¨ä¸€å€‹å«æœ‰ `CQHTTPMessage` **æˆ–** `CQTag` **æˆ–** `string` çš„æ•¸çµ„ä½œç‚ºæ¶ˆæ¯æ–‡æœ¬ã€‚
(`CQTag` å¯åƒè€ƒ [CQ ç¢¼ç›¸é—œé¡åˆ¥](../api/messages.md))

èˆ‰å€‹å¿«é€ŸéŸ¿æ‡‰çš„ä¾‹å­ï¼š
```js
bot.on('message', () => {
  return [
    {
      type: 'at',
      data: {
        qq: '123'
      }
    },
    'ä½ å¥½~ ',
    new CQEmoji(129303) // ğŸ¤—
  ]
})
```
æ¯ç•¶æ©Ÿå™¨äººæ”¶åˆ°æ¶ˆæ¯æ™‚ï¼Œä¾¿æœƒå›æ‡‰ `"[CQ:at,qq=123]ä½ å¥½~ ğŸ¤—"`ã€‚

### å»¶ä¼¸é–±è®€
- [CQ ç¢¼](https://d.cqp.me/Pro/CQ%E7%A0%81)
- [CQHTTP API ä¹‹æ¶ˆæ¯æ ¼å¼](https://cqhttp.cc/docs/#/Message)
- [CQHTTP API ä¹‹ CQ ç¢¼](https://cqhttp.cc/docs/#/CQCode)
